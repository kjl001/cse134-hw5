<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="HW5 Part 1">
	<meta name="keywords" content="HTML">
	<meta name="author" content="Kevin Lee">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HW5 Part 1</title>
	<link href="images/favicon.ico" rel="icon">
</head>

<body>
	<form>
		<label for="record_id">Record ID: </label>
		<input type="text" id="record_id" name="record_id"> <br>
		<label for="article_name">Article Name: </label>
		<input type="text" id="article_name" name="article_name"> <br>
		<label for="article_body">Article Body: </label>
		<textarea id="article_body" name="article_body" rows="4" cols="50"></textarea> <br>
		<input type="hidden" id="date" name="date">
	</form>

	<hr>

	<button type="button" id="postBtn">POST</button>
	<button type="button" id="getBtn">GET</button>
	<button type="button" id="putBtn">PUT</button>
	<button type="button" id="deleteBtn">DELETE</button>

	<output id="response"></output>

	<script type="module">
		window.addEventListener('DOMContentLoaded', init);

		function init() {
			document.getElementById('postBtn').addEventListener('click', handlePost);
			document.getElementById('getBtn').addEventListener('click', handleGet);
			document.getElementById('putBtn').addEventListener('click', handlePut);
		}

		async function handlePost() {
			const response = await fetch(`https://httpbin.org/post`, {
				method: 'POST',
				mode: 'cors',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'X-Sent-By': 'javascript'
				},
				body: encodeURIComponent(`${new Date()}`)
			});

			if (response.ok) {
				let responseText = await response.json();
				document.getElementById('date').innerText = responseText.form;
				console.log(responseText.form);
			}
			else {
				console.log("Post Function Error");
			}
		}

		async function handleGet() {
			const response = await fetch('https://httpbin.org/get', {
				method: 'GET'
			});

			if (response.ok) {
				const data = await response.json();
				document.getElementById('response').innerText = data;
				console.log(data);
			}
			else {
				console.log('Get Function Error')
			}
		}

		async function handlePut() {
			const data = {
				record_id: '5',
				article_name: 'Man Yells at Cloud',
				article_body: 'Old man decides to be angry at everything, including clouds.',
				date: `${new Date()}`
			};
			const response = await fetch('https://httpbin.org/put', {
				method: 'PUT',
				headers: {

				},
				body: JSON.stringify(data)
			});

			if (response.ok) {
				const data = await response.json();
				document.getElementById('record_id').value = data.json.record_id;
				document.getElementById('article_name').value = data.json.article_name;
				document.getElementById('article_body').innerText = data.json.article_body;
				document.getElementById('date').innerText = data.json.date;
			} else {
				console.log("Put Function Error");
			}
		}
	</script>
</body>
</html>