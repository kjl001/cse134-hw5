<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="HW5 Part 1">
	<meta name="keywords" content="HTML">
	<meta name="author" content="Kevin Lee">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HW5 Part 1</title>
	<link href="images/favicon.ico" rel="icon">
</head>

<body>
	<form>
		<label for="record_id">Record ID: </label>
		<input type="text" id="record_id" name="record_id"> <br>
		<label for="article_name">Article Name: </label>
		<input type="text" id="article_name" name="article_name"> <br>
		<label for="article_body">Article Body: </label>
		<textarea id="article_body" name="article_body" rows="4" cols="50"></textarea> <br>
		<input type="hidden" id="date" name="date">
	</form>

	<hr>

	<button type="button" id="postBtn">POST</button>
	<button type="button" id="getBtn">GET</button>
	<button type="button" id="putBtn">PUT</button>
	<button type="button" id="deleteBtn">DELETE</button>

	<output id="response"></output>

	<script type="module">
		window.addEventListener('DOMContentLoaded', init);

		function init() {
			document.getElementById('postBtn').addEventListener('click', handlePost);
			document.getElementById('getBtn').addEventListener('click', handleGet);
			document.getElementById('putBtn').addEventListener('click', handlePut);
			document.getElementById('deleteBtn').addEventListener('click', handleDelete);
		}

		async function handlePost() {
			const recID = encodeURIComponent(document.getElementById('record_id').value);
			const artName = encodeURIComponent(document.getElementById('article_name').value);
			const artBody = encodeURIComponent(document.getElementById('article_body').value);
			const response = await fetch(`https://httpbin.org/post`, {
				method: 'POST',
				mode: 'cors',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'X-Sent-By': 'javascript'
				},
				body: `record_id=${recID}&article_name=${artName}&article_body=${artBody}&date=${encodeURIComponent(new Date())}`
			});

			if (response.ok) {
				let data = await response.json();
				document.getElementById('date').value = data.form.date;
			}
			else {
				console.log("Post Function Error");
			}
		}

		/* Type in form and use that to GET */
		async function handleGet() {
			const recID = encodeURIComponent(document.getElementById('record_id').value);
			const artName = encodeURIComponent(document.getElementById('article_name').value);
			const artBody = encodeURIComponent(document.getElementById('article_body').value);
			const date = encodeURIComponent(document.getElementById('date').innerText);
			const url = `https://httpbin.org/get?record_id=${recID}&article_name=${artName}&article_body=${artBody}&date=${date}`;
			const response = await fetch(url, {
				method: 'GET'
			});

			if (response.ok) {
				const data = await response.json();
				console.log(data);
			}
			else {
				console.log('Get Function Error');
			}
		}

		async function handlePut() {
			const recID = encodeURIComponent(document.getElementById('record_id').value);
			const artName = encodeURIComponent(document.getElementById('article_name').value);
			const artBody = encodeURIComponent(document.getElementById('article_body').value);
			const response = await fetch('https://httpbin.org/put', {
				method: 'PUT',
				mode: 'cors',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded',
					'X-Sent-By': 'javascript'
				},
				body: `record_id=${recID}&article_name=${artName}&article_body=${artBody}&date=${encodeURIComponent(new Date())}`
			});

			if (response.ok) {
				const data = await response.json();
				document.getElementById('date').value = data.form.date;
			} else {
				console.log("Put Function Error");
			}
		}

		async function handleDelete() {
			const recID = encodeURIComponent(document.getElementById('record_id').value);
			const artName = encodeURIComponent(document.getElementById('article_name').value);
			const artBody = encodeURIComponent(document.getElementById('article_body').value);
			const date = encodeURIComponent(document.getElementById('date').innerText);
			const url = `https://httpbin.org/get?record_id=${recID}&article_name=${artName}&article_body=${artBody}&date=${date}`;
			const response = await fetch(url, {
				method: 'DELETE',
			});

			if (response.ok) {
				const data = await response.json();
				console.log(data);
			} else {
				console.log("Delete Function Error");
			}
		}
	</script>
</body>
</html>